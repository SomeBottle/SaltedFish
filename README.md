# SaltedFish

[![demo](./images/demo.jpg)](https://www.bilibili.com/video/BV15s411E7jf/)  
> ç‚¹å‡»å›¾ç‰‡å¯ä»¥è§‚çœ‹æ¼”ç¤ºè§†é¢‘  

18 å¹´ 6 æœˆé‚£ä¼šå„¿æ‘¸ç´¢è½®è¯¢è¯·æ±‚ã€WebSocket æ—¶åšçš„ä¸€ä¸ªè”æœºåŒğŸŸå¯¹æˆ˜å°æ¸¸æˆï¼Œä»£ç å¾ˆç³Ÿç³•ï¼Œä½†æ˜¯èƒ½è·‘.jpg  

## ç¢ç¢å¿µ

æœ€å¼€å§‹æ—¶è¿™ä¸ªæ¸¸æˆæ˜¯çº¯ç”¨è½®è¯¢è¯·æ±‚å®ç°çš„ï¼Œæ¯ä¸ªç©å®¶ç«¯åœ¨æ¸¸ç©æœŸé—´ä¼šç»™æœåŠ¡ç«¯å‘é€å¤§é‡è¯·æ±‚æ¥è·å–çŠ¶æ€ä¿¡æ¯ï¼Œä½†æ˜¯ä½ è¿˜åˆ«è¯´ï¼Œè”æœºæ•ˆæœè¿˜çœŸèƒ½å®ç° ğŸ˜‚...åæ¥å‘è§‰è¿™æ ·ä¸å¤ªè¡Œï¼Œå°±å­¦äº†ä¸€ä¸‹ Workerman æ¡†æ¶ï¼Œæ¢ä¸Š WebSocket é•¿è¿æ¥äº†ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨è¿™ä¸ªä»“åº“ä¸­çš„ç‰ˆæœ¬ã€‚    

å¦å¤–å°±æ˜¯å½“æ—¶é«˜ä¸­çš„æ—¶å€™å’Œéš”å£ç­ç”¨è¿™ä¸ªæ¸¸æˆå¯¹æˆ˜è¿‡ï¼Œçœ‹åˆ°å¤§å®¶ç©è‡ªå·±çš„æ¸¸æˆç©çš„è¿™ä¹ˆå¼€å¿ƒï¼ŒçœŸçš„æ˜¯å¾ˆç¾å¥½çš„å›å¿†äº†ï¼  

ä¸è¿‡ç°åœ¨çœ‹æ¥ä¸ä»…ä»£ç å†™å¾—åƒä¸€å¨ğŸ’©ï¼Œå¥½åƒæ²¡è€ƒè™‘ä»€ä¹ˆå¹¶å‘é—®é¢˜ï¼Œéƒ¨ç½²çš„æ—¶å€™çœŸçš„ä¹Ÿè¿˜æŒºéº»çƒ¦çš„ï¼Œæ­£å¥½æœ€è¿‘æƒ³èµ·æ¥è¿™ç©æ„äº†ï¼Œå¹²è„†æ‰“åŒ…æˆ~~ç²¾è‡´çš„~~ Docker é•œåƒå§~    

* âš  æ³¨ï¼š**å¯èƒ½æœ‰æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆLFIï¼‰ç­‰æ¼æ´**ï¼Œå› æ­¤å¦‚æœè¦åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„è¯ï¼Œ `backend` éƒ¨åˆ†ä¸€å®šè¦åœ¨ Docker å®¹å™¨å†…è¿è¡Œï¼Œ**ä¸è¦æŒ‚è½½å®¿ä¸»æœºçš„æ•æ„Ÿç›®å½•ï¼Œæ›´ä¸è¦ç›´æ¥åœ¨å®¿ä¸»æœºä¸Šè·‘**ã€‚    

å¤§æ¦‚ä¹Ÿä¸ä¼šå†æ›´æ–°äº†ï¼Œå½“ä½œä¸€ä¸ªçºªå¿µé¡¹ç›®å§ï¼Œè‡´å½“å¹´å¼€å¿ƒæ‘†å¼„ PHP çš„é‚£æ®µæ—¶å…‰ã€‚  

## éƒ¨ç½²

### åç«¯éƒ¨åˆ†

* ç›¸åº”æºç ä½äºæœ¬ä»“åº“çš„ `./backend` ç›®å½•ä¸‹  
* å®é™…ä¸Šåç«¯éƒ¨åˆ†ä¹Ÿæ˜¯æœ‰å¯ä»¥é…ç½®çš„åœ°æ–¹çš„ (`./backend/config`)ï¼Œä¸è¿‡ä¸ºäº†ç®€ç•¥èµ·è§è¿™é‡Œå°±ä¸å†™äº†  

ç›´æ¥æ‹‰å– Docker å®¹å™¨å³å¯å¿«é€Ÿè¿›è¡Œéƒ¨ç½²:  

```bash
docker pull somebottle/saltedfish-backend:1.6.1
```
> å®¹å™¨é•œåƒé‡‡ç”¨æœ€å°åŒ–æ„å»ºï¼Œç¨‹åºæ‰§è¡Œç”¨æˆ·ä¸º**é root ç”¨æˆ·**ï¼Œå¯æ”¾å¿ƒä½¿ç”¨ã€‚  

å®¹å™¨å†…ä¼šç›‘å¬ä¸¤ä¸ªç«¯å£:  

| ç«¯å£ | è¯´æ˜ |
| ---- | ---- |
| `8080` | HTTP æœåŠ¡ç«¯å£ï¼Œæ¸¸æˆçš„ API æ¥å£ |
| `9527` | WebSocket æœåŠ¡ç«¯å£ï¼Œæ¸¸æˆçš„å®æ—¶é€šä¿¡æ¥å£ |

å¯åŠ¨å®¹å™¨æ—¶å¯ä»¥æŒ‡å®šç«¯å£æ˜ å°„:  

```bash
docker run -d --name fish --restart unless-stopped -p 9680:8080 -p 9681:9527 somebottle/saltedfish-backend:1.6.1
```
> è¿™æ ·ä¸€æ¥å°±æŠŠå®¹å™¨å†…çš„ `8080` å’Œ `9527` ç«¯å£åˆ†åˆ«æ˜ å°„åˆ°å®¿ä¸»æœºçš„ `9680` å’Œ `9681` ç«¯å£äº†ã€‚  

### å‰ç«¯éƒ¨åˆ†

* ç›¸åº”æºç ä½äºæœ¬ä»“åº“çš„ `./frontend` ç›®å½•ä¸‹.

å‰ç«¯éƒ¨åˆ†éƒ¨ç½²åœ¨é™æ€æ‰˜ç®¡æœåŠ¡ä¸Šå³å¯ï¼Œå¦‚ Github Pagesã€Vercelã€Netlify ç­‰ã€‚  

ä¸ºäº†è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œä½ éœ€è¦ä¿®æ”¹ `./frontend/jcs/config.js` ä¸­çš„éƒ¨åˆ†é…ç½®:  

```javascript
var servers = {
	server1: {
		name: 'è‡ªç”±â™‚ç¾åˆ©åš',
		ws: 'ws://127.0.0.1:9681', // 9681 æ˜¯ä¸Šé¢ Docker å®¹å™¨æ˜ å°„çš„ WebSocket ç«¯å£
		core: 'http://127.0.0.1:9680/core/' // 9680 æ˜¯ä¸Šé¢ Docker å®¹å™¨æ˜ å°„çš„ HTTP æœåŠ¡ç«¯å£, /core/ æ˜¯åç«¯ API çš„ä¸»è·¯å¾„
	},
    // å½“ç„¶è¿™é‡Œæ”¯æŒå¤šä¸ªæœåŠ¡å™¨é…ç½®
}
// é»˜è®¤è¿æ¥çš„æœåŠ¡å™¨ï¼Œä¸æ˜¯å½“å‰ç”¨æˆ·é€‰æ‹©çš„æœåŠ¡å™¨
// å½“å½“å‰ç”¨æˆ·é€‰æ‹©çš„æœåŠ¡å™¨æ— æ³•è¿æ¥æ—¶ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸ºè¿™ä¸ªæœåŠ¡å™¨
var defaultserver = 'server1';
```

è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­è¿˜æœ‰å…¶ä»–ä¸¤é¡¹:  

```javascript
var musiclist = ['https://resources.xbottle.top/Radius.mp3']; // æ¸¸æˆä¸»ç•Œé¢çš„éšæœºåˆ‡æ­Œåˆ—è¡¨
var soundResourceBase = './sound/'; // ä¸ºäº†åŠ é€ŸéŸ³æ•ˆèµ„æºçš„è½½å…¥ï¼Œä½ å¯ä»¥è‡ªè¡ŒæŠŠ sound/ ç›®å½•ä¸‹çš„éŸ³æ•ˆæ–‡ä»¶ä¸Šä¼ åˆ°é™æ€æ‰˜ç®¡æœåŠ¡ä¸Šï¼Œç„¶åä¿®æ”¹è¿™ä¸ªè·¯å¾„ä¸ºå¯¹åº”çš„ URL åœ°å€ï¼Œæœ«å°¾ä¸è¦æ‰äº† '/'
```

## è¿›é˜¶é…ç½®

ä¸ºäº†ä½¿ç”¨å®‰å…¨è¿æ¥ï¼Œä½ å¯ä»¥åˆ©ç”¨ Nginx ä»£ç†ä¸Šé¢è¿™ä¸¤ä¸ªæ¥å£ã€‚åœ¨ Nginx å¯ç”¨ SSL æ¨¡å—åï¼Œç¤ºä¾‹é…ç½®å¦‚ä¸‹:  

```conf
location /fish_backend/ {
    proxy_pass http://127.0.0.1:9680/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    rewrite ^/fish_backend/(.*)$ /$1 break;
}

location /fish_wss/ {
    proxy_pass http://127.0.0.1:9681;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    rewrite /fish_wss/(.*) /$1 break;
    proxy_redirect off;
}
```

è¿™æ ·ä¸€æ¥å°±å¯ä»¥è¿™æ ·é…ç½®å‰ç«¯çš„ `./frontend/jcs/config.js` æ–‡ä»¶äº†:  

```javascript
var servers = {
	server1: {
		name: 'è‡ªç”±â™‚ç¾åˆ©åš',
		ws: 'wss://<backend_domain>/fish_wss/', 
		core: 'https://<backend_domain>/fish_backend/core/'
	},
}
```

## License

[Apache License 2.0](./LICENSE)

